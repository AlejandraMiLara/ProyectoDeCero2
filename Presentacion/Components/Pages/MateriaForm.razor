@page "/materias/form"
@page "/materias/form/{Id:int}"
@using Entidades
@using ProyectoDeCero2.Servicios
@using Servicios;
@inject IMateriaServicios MateriaServicios
@inject NavigationManager NavigationManager

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-primary text-white py-3">
                    <h4 class="mb-0">
                        <i class="fas fa-book me-2"></i>
                        @(materia.IdMateria == 0 ? "Crear Nueva Materia" : "Editar Materia")
                    </h4>
                </div>

                <div class="card-body p-4">
                    <EditForm Model="@materia" OnValidSubmit="GuardarCarrera">
                        <DataAnnotationsValidator />
                        <ValidationSummary class="alert alert-danger mb-4" />

                        <!-- Información Básica -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3 border-bottom pb-2">
                                    <i class="fas fa-info-circle me-2"></i>Información Básica
                                </h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputText id="clave" class="form-control" placeholder="Clave" @bind-Value="materia.ClaveMateria" />
                                    <label for="clave" class="form-label">Clave de Materia</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputText id="materia" class="form-control" placeholder="Materia" @bind-Value="materia.PropositoMateria" />
                                    <label for="materia" class="form-label">Materia</label>
                                </div>
                            </div>
                        </div>

                        <!-- Horas -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3 border-bottom pb-2">
                                    <i class="fas fa-clock me-2"></i>Distribución de Horas
                                </h5>
                            </div>
                            <div class="col-md-4 col-6 mb-3">
                                <div class="form-floating">
                                    <InputNumber id="hc" class="form-control" placeholder="HC" @bind-Value="materia.HCMateria" />
                                    <label for="hc" class="form-label">HC</label>
                                </div>
                            </div>
                            <div class="col-md-4 col-6 mb-3">
                                <div class="form-floating">
                                    <InputNumber id="hl" class="form-control" placeholder="HL" @bind-Value="materia.HLMateria" />
                                    <label for="hl" class="form-label">HL</label>
                                </div>
                            </div>
                            <div class="col-md-4 col-6 mb-3">
                                <div class="form-floating">
                                    <InputNumber id="ht" class="form-control" placeholder="HT" @bind-Value="materia.HTMateria" />
                                    <label for="ht" class="form-label">HT</label>
                                </div>
                            </div>
                            <div class="col-md-4 col-6 mb-3">
                                <div class="form-floating">
                                    <InputNumber id="hpc" class="form-control" placeholder="HPC" @bind-Value="materia.HPCMateria" />
                                    <label for="hpc" class="form-label">HPC</label>
                                </div>
                            </div>
                            <div class="col-md-4 col-6 mb-3">
                                <div class="form-floating">
                                    <InputNumber id="hcl" class="form-control" placeholder="HCL" @bind-Value="materia.HCLMateria" />
                                    <label for="hcl" class="form-label">HCL</label>
                                </div>
                            </div>
                            <div class="col-md-4 col-6 mb-3">
                                <div class="form-floating">
                                    <InputNumber id="he" class="form-control" placeholder="HE" @bind-Value="materia.HEMateria" />
                                    <label for="he" class="form-label">HE</label>
                                </div>
                            </div>
                            <div class="col-md-4 col-6 mb-3">
                                <div class="form-floating">
                                    <InputNumber id="cr" class="form-control" placeholder="CR" @bind-Value="materia.CRMateria" />
                                    <label for="cr" class="form-label">CR</label>
                                </div>
                            </div>
                        </div>

                        <!-- Contenido Académico -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3 border-bottom pb-2">
                                    <i class="fas fa-graduation-cap me-2"></i>Contenido Académico
                                </h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputText id="competencia" class="form-control" placeholder="Competencia" @bind-Value="materia.CompetenciaMateria" />
                                    <label for="competencia" class="form-label">Competencia</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputText id="evidencia" class="form-control" placeholder="Evidencia" @bind-Value="materia.EvidenciaMateria" />
                                    <label for="evidencia" class="form-label">Evidencia</label>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <div class="form-floating">
                                    <InputText id="metodologia" class="form-control" placeholder="Metodología" @bind-Value="materia.MetodologiaMateria" />
                                    <label for="metodologia" class="form-label">Metodología</label>
                                </div>
                            </div>
                        </div>

                        <!-- Campos de Texto Largos -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3 border-bottom pb-2">
                                    <i class="fas fa-file-alt me-2"></i>Información Detallada
                                </h5>
                            </div>
                            <div class="col-12 mb-3">
                                <div class="form-floating">
                                    <InputTextArea id="criterios" class="form-control" placeholder="Criterios" style="height: 100px" @bind-Value="materia.CriteriosMateria" />
                                    <label for="criterios" class="form-label">Criterios</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputTextArea id="biba" class="form-control" placeholder="Bibliografía Básica" style="height: 100px" @bind-Value="materia.BibliografiaBasicaMateria" />
                                    <label for="biba" class="form-label">Bibliografía Básica</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputTextArea id="bico" class="form-control" placeholder="Bibliografía Complementaria" style="height: 100px" @bind-Value="materia.BibliografiaCompletenciaMateria" />
                                    <label for="bico" class="form-label">Bibliografía Complementaria</label>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <div class="form-floating">
                                    <InputTextArea id="perdoc" class="form-control" placeholder="Perfil Docente" style="height: 100px" @bind-Value="materia.PerfilDocente" />
                                    <label for="perdoc" class="form-label">Perfil Docente</label>
                                </div>
                            </div>
                        </div>

                        <!-- Configuración Adicional -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3 border-bottom pb-2">
                                    <i class="fas fa-cog me-2"></i>Configuración Adicional
                                </h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputText id="pua" class="form-control" placeholder="Ruta PUA" @bind-Value="materia.PathPUAMateria" />
                                    <label for="pua" class="form-label">Ruta PUA</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <InputSelect id="nivel" class="form-control" @bind-Value="materia.IdNivelAcademico">
                                        <option value="">-- Seleccione un nivel --</option>
                                        @foreach (var nivel in nivelesAcademicos ?? new List<E_NivelAcademico>())
                                        {
                                            <option value="@nivel.IdNivelAcademico">@nivel.NombreNivelAcademico</option>
                                        }
                                    </InputSelect>
                                    <label for="nivel" class="form-label">Nivel Académico</label>
                                </div>
                            </div>
                        </div>

                        <!-- Estado -->
                        <div class="mb-4">
                            <div class="form-check form-switch">
                                <InputCheckbox id="estado" class="form-check-input" @bind-Value="materia.EstadoMateria" />
                                <label class="form-check-label fw-medium" for="estado">Estado Activo</label>
                            </div>
                        </div>

                        <!-- Botones -->
                        <div class="d-flex gap-2 justify-content-end pt-3 border-top">
                            <button type="button" class="btn btn-outline-secondary" @onclick="Cancelar">
                                <i class="fas fa-times me-1"></i> Cancelar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Guardar
                            </button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private E_Materia materia = new E_Materia();
    private List<E_NivelAcademico> nivelesAcademicos;

    protected override async Task OnInitializedAsync()
    {
        nivelesAcademicos = await MateriaServicios.ObtenerTodosLosNivelesAcademicosAsync()
                              ?? new List<E_NivelAcademico>();
    }

    protected override async Task OnParametersSetAsync()
    {
        if (Id != 0)
        {
            materia = await MateriaServicios.ObtenerMateriaPorIdAsync(Id);
        }
    }

    private async Task GuardarCarrera()
    {
        await MateriaServicios.GuardarMateriaAsync(materia);
        NavigationManager.NavigateTo("/materias");
    }

    private void Cancelar()
    {
        NavigationManager.NavigateTo("/materias");
    }
}